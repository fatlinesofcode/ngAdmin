var app=angular.module("app",["ngRoute","ngAnimate","ngResource","ngCookies"]);app.config(["$locationProvider",function(a){a.html5Mode(!1).hashPrefix("!")}]),deferredBootstrapper.bootstrap({element:document,module:"app",resolve:{CmsConfig:function(a){return a.get("./assets/config.json")}}}),function(a){function b(){throw"Static Class. AppConfig cannot be instantiated."}var c=b;c.templatePath="./",c.testMode=!1,c.uploadPath="../uploads/",a.AppConfig=b}(app=app||{});var app;app.filter("titlecase",function(){return function(a){log("3","filter",a,"");var b=a.replace("_"," ");return b.substr(0,1).toUpperCase()+""+b.substr(1)}}),app.filter("maxChars",function(){return function(a,b){return a.length>b?a.substr(0,b)+"...":a}}),app.filter("dateformat",["$filter","CmsConfig",function(a,b){return function(c){if(!c)return"";var d=new Date(c.replace(/-/g,"/"));return a("date")(d,b.dateFormat)}}]);var $defer,loaded=!1;app.run(["$q","$timeout",function(a,b){function c(){"loaded"==CKEDITOR.status?(loaded=!0,$defer.resolve()):c()}if($defer=a.defer(),angular.isUndefined(CKEDITOR))throw new Error("CKEDITOR not found");CKEDITOR.disableAutoInline=!0,CKEDITOR.on("loaded",c),b(c,100)}]),app.directive("ngCkeditor",["$timeout","$q",function(a,b){"use strict";return{restrict:"AC",require:["ngModel","^?form"],scope:!1,link:function(c,d,e,f){var g=f[0],h=f[1]||null,i="<p></p>",j="textarea"==d[0].tagName.toLowerCase(),k=[],l=!1;j||d.attr("contenteditable",!0);var m=function(){var f={toolbar:"full",toolbar_full:[{name:"basicstyles",items:["Bold","Italic","Strike","Underline"]},{name:"paragraph",items:["BulletedList","NumberedList","Blockquote"]},{name:"editing",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"links",items:["Link","Unlink","Anchor"]},{name:"tools",items:["SpellChecker","Maximize"]},"/",{name:"styles",items:["Format","FontSize","TextColor","PasteText","PasteFromWord","RemoveFormat"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"forms",items:["Outdent","Indent"]},{name:"clipboard",items:["Undo","Redo"]},{name:"document",items:["PageBreak","Source"]}],disableNativeSpellChecker:!1,enterMode:CKEDITOR.ENTER_BR,uiColor:"#FAFAFA",height:"400px",width:"100%"};f=angular.extend(f,c[e.ngCkeditor]);var m=j?CKEDITOR.replace(d[0],f):CKEDITOR.inline(d[0],f),n=b.defer();d.bind("$destroy",function(){m.destroy(!1)});var o=function(b){var c=m.getData();c==i&&(c=null),a(function(){g.$setViewValue(c),b===!0&&h&&h.$setPristine()},0)},p=function(a){if(k.length){var b=k.pop()||i;l=!1,m.setData(b,function(){o(a),l=!0})}};m.on("change",o),m.on("blur",o),m.on("key",o),m.on("instanceReady",function(){c.$apply(function(){p(!0)})}),m.on("customConfigLoaded",function(){n.resolve()}),g.$render=function(){void 0===g.$viewValue&&(g.$setViewValue(null),g.$viewValue=null),k.push(g.$viewValue),l&&p()}};"loaded"==CKEDITOR.status&&(loaded=!0),loaded?m():$defer.promise.then(m)}}}]),app.directive("ngFileReaderImage",["$timeout",function(){return{restrict:"A",priority:1,scope:{base64data:"=ngFileReaderImage",filename:"="},template:'<div  class="preview"><img ng-src="{{image.src}}" /></div> <input type="file" class="imageLoader" name="imageLoader" accept="image/*"/>',link:function(a,b,c){var d,e=function(){d=a.$watch("filename",l),i.bind("change",j)},f=c.resizeWidth||320,g=c.resizeHeight||240,h=c.resizeQuality||80,i=b.find("input[type='file']"),j=function(b){a.processing=!0;var d=b.target.files[0];log("49","onFileReaderImageSelect","file resizeWidth",c.resizeWidth,a.$eval(c.resizeWidth));var e=new FileReader;e.onloadend=function(a){var b=a.target.result;canvasResize(d,{width:f||b.width,height:g||b.height,crop:!1,quality:h,callback:function(a){var b=new Image;b.onload=function(){k(b)},b.src=a}})},e.readAsDataURL(d)};a.fileReaderImageSelect=function(){log("37","scope","fileReaderImageSelect","",b);var a=confirm("This feature would like to access your photos");a&&i.click()};var k=function(b){a.$apply(function(){a.image=b,a.base64data=b.src})},l=function(){if(log("83","onFilenameChange","onFilenameChange",""),a.filename&&!a.image){var b=new Image;b.onload=function(){a.$apply(function(){d(),a.image=b})},b.src=app.AppConfig.uploadPath+a.filename}};e()}}}]),app.directive("ngInputName",["$timeout","$parse","$compile",function(){return{restrict:"A",link:function(a,b,c){a.$eval(c.ngInputName)}}}]),app.directive("ngSvgLoading",["$timeout",function(){return{restrict:"A",template:'<ng-include src="path"></ng-include>',link:function(a,b,c){a.path="assets/img/loading-"+c.ngSvgLoading+".svg"}}}]),app.Routes=[],app.Routes.push({name:"home"}),app.Routes.push({name:"edit"}),app.Routes.push({name:"login"}),app.Routes.push({name:"edit",url:"edit/:table/:id",templateUrl:app.AppConfig.templatePath+"edit.tpl.html"}),app.Routes.push({name:"list",url:"list/:table",templateUrl:app.AppConfig.templatePath+"list.tpl.html"}),app.config(["$routeProvider",function(a){for(var b in app.Routes){var c=app.Routes[b];c.url=c.url||c.name,c.title=c.title||c.name,c.templateUrl=c.templateUrl||app.AppConfig.templatePath+c.url.replace("/","-")+".tpl.html",c.controller=c.controller||c.name.charAt(0).toUpperCase()+c.name.substr(1).toLowerCase()+"Controller",a.when("/"+c.url,{templateUrl:c.templateUrl,controller:c.controller})}a.otherwise({redirectTo:"/login"})}]),app.factory("routeService",["$timeout","$location",function(a,b){var c={};return c.redirectTo=function(c){c=angular.isArray(c)?c:[c];var d="";c&&(d=c.length>0?c.join("/"):""),a(function(){b.path(d)})},c.currentPath=function(){var a=b.path().replace("/","");return a=a.split("/")},c.getRoutePosition=function(a){var b=0;for(var c in app.Routes){if(app.Routes[c].url==a)return b;b++}return-1},c.currentRoute=function(){var a=b.path().replace("/","");return a=a.split("/")[0],""==a&&(a="home"),a},c}]),app.factory("apiService",["$resource","$cookieStore","routeService","CmsConfig",function(a,b,c,d){service=null;var e=service;e={};var f,g="./include/api.php";f=a(g,{},{update:{method:"JSON"},post:{method:"post"}}),e.loggedin=!1,e.initialize=function(){},e.resource=function(){return f};var h=function(a){a=a?"\n"+a:"",alert("Oops...\n an error occurred communicating with the API."+a)};return e.get_row_count=function(a,b,c){e.post("get_row_count",a,b,c)},e.get_rows=function(a,b,c,f){b||(b={}),b.table=a,b.order_by||(b.order_by=d.order_by),e.post("get_rows",b,c,f)},e.get_row=function(a,b,c,d){b||(b={}),b.table=a,e.post("get_row",b,c,d)},e.save_row=function(a,b,c){e.post("save_row",a,b,c)},e.delete_row=function(a,b,c){e.post("delete_row",a,b,c)},e.post=function(a,c,d,g){g=g||h,d=d||function(){},c.username=b.get("username"),c.password=b.get("password"),f.post({action:a},c,function(a){a.error&&h(a.error),a.badlogin&&e.logout(),d(a)},g)},e.logout=function(){b.put("loggedin","no"),b.remove("username"),b.remove("password"),e.loggedin=!1,c.redirectTo("login")},e.login=function(a,c,d){d=d||h,c=c||function(){},a=angular.copy(a),a.password&&(a.password=MD5(a.password)),f.post({action:"login"},a,function(d){b.put("loggedin",d.result?"yes":"no"),b.put("username",a.username),b.put("password",a.password),e.loggedin=d.result,log("98","service","",d),c(d)},d)},e.initialize(),e}]),app.factory("eventService",["$rootScope","$timeout",function(a,b){service=null;var c=service;return c={},c.initialize=function(){},c.broadcast=function(c,d,e){log("--","eventService","broadcast",c,d);var f=function(){a.$broadcast(c,d)};e?b(f,50):f()},c.emit=function(c,d,e){log("--","eventService","emit",c,d);var f=function(){a.$emit(c,d)};e?b(f,50):f()},c.on=function(b,c){a.$on(b,c)},c.initialize(),c}]),app.controller("AppController",["$scope","$timeout","$rootScope","routeService","eventService","$routeParams","apiService","$cookieStore","CmsConfig",function(a,b,c,d,e,f,g,h,i){var j=this;j=a,j.pageClass="",j.debug=$("body").hasClass("debug-enabled"),c.doctitle="",j.initialize=function(){log("8","AppController","initialize","",d.currentRoute()),j.config=i,k(!0)};var k=function(){j.$on("$destroy",l),j.$on("$routeChangeStart",o),j.$on("$routeChangeSuccess",n),j.$on("$viewContentLoaded",m)},l=function(){k(!1)},m=function(){},n=function(){j.pageClass=d.currentRoute()};j.refresh=function(){b(function(){})},j.redirectTo=function(a){d.redirectTo(a)},j.runTest=function(a){e.emit(AppEvent.RUN_TEST,a)},j.setTitle=function(a,b){j.currenttable=a,j.title=angular.isArray(b)?b.join(" / "):"",c.doctitle=j.config.sitetitle,j.currenttable&&(c.doctitle+=" | "+j.currenttable),j.title&&(c.doctitle+=" | "+j.title)};var o=function(a,b,c){j.isLoggedIn()||d.redirectTo("login");var e=0,f=0;b&&c&&(b.originalPath&&(e=d.getRoutePosition(b.originalPath.replace("/",""))),c.originalPath&&(f=d.getRoutePosition(c.originalPath.replace("/","")))),j.viewAnimationDirection=0>f?"direction-left":f>e?"direction-right":"direction-left"};return j.isLoggedIn=function(){return"yes"==h.get("loggedin")},j.initialize(),j}]),app.controller("EditController",["$scope","$routeParams","apiService","routeService","CmsConfig",function(a,b,c,d,e){var f=this;f=a,f.formdata=null,f.image={},f.state="",f.processing=!1,f.initialize=function(){f.table=b.table,f.id=b.id,f.fields=e.tables[f.table].editfields,f.setTitle(f.table,["edit"]),f.ckeditorOptions={height:"150px",format_tags:"h3;div;p",toolbar_full:[{name:"basicstyles",items:["Bold","Italic","Underline"]},{name:"paragraph",items:["BulletedList","NumberedList"]},{name:"editing",items:["JustifyLeft","JustifyCenter","JustifyRight"]},{name:"styles",items:["PasteText","PasteFromWord","RemoveFormat"]},{name:"formatting",items:["Outdent","Indent","Format","Source"]}]},log("11","EditController","initialize",b.table),f.id&&i(),g(!0)};var g=function(a){a&&f.$on("$destroy",h)},h=function(){g(!1)};f.setImage=function(){log("51","EditController","setImage","")},f.save=function(a){log("30","EditController","save",a,"valid",f.form),f.state="submitted",f.form.$invalid||(a.table=f.table,a.id=f.id,f.processing=!0,c.save_row(a,function(){f.state="complete",i()}))};var i=function(){f.formdata=null,c.get_row(f.table,{id:f.id},function(a){f.formdata={};for(var b in a)for(var c=0;c<f.fields.length;c++){var d=f.fields[c];d.name==b&&(log("21","EditController","response",b,a[b],f.fields.indexOf(b)),f.formdata[b]=a[b])}log("82","getFormData","formdata",f.formdata),f.setTitle(f.table,["edit",f.formdata.title]),f.form.$setPristine(),f.processing=!1})};return f.delete=function(a,b){var d=confirm("Are you sure you want to delete '"+a+"'?");if(d){var e={};e.table=f.table,e.id=b,f.processing=!0,c.delete_row(e,function(){f.processing=!1,f.redirectTo("list/"+f.table)})}},f.cancel=function(){f.redirectTo("list/"+f.table)},f.hello=function(){log("121","EditController","hello","")},f.initialize(),f}]),app.controller("ListController",["$scope","$routeParams","apiService","CmsConfig","$timeout",function(a,b,c,d,e){var f=this;f=a;var g=null;f.initialize=function(){f.table=b.table,f.fields=d.tables[f.table].listfields,f.order_by=d.tables[f.table].order_by||d.order_by,f.setTitle(f.table,["list"]),h(),i(!0)};var h=function(){f.processing=!0;for(var a=[],b=0;b<f.fields.length;b++){var d=f.fields[b];a.push(d.name)}var e={fields:a};e.order_by=f.order_by,c.get_rows(f.table,e,function(a){f.listdata=a.result,f.processing=!1})},i=function(a){a&&f.$on("$destroy",j)},j=function(){i(!1)};return f.toggleActive=function(a){var b={};b.table=f.table,b.id=a.id,b.active=!a.active,f.processing=!0,c.save_row(b,function(){h()})},f.delete=function(a,b){var d=confirm("Are you sure you want to delete '"+a+"'?");if(d){var e={};e.table=f.table,e.id=b,c.delete_row(e,function(){h()})}},f.onInputChange=function(a,b,d){var i={};i.table=f.table,i.id=a,i[b]=d,e.cancel(g),g=e(function(){f.processing=!0,c.save_row(i,function(){h()})},500)},f.initialize(),f}]),app.controller("LoginController",["$scope","$timeout","apiService","routeService","$cookieStore",function(a,b,c,d){var e=this;e=a,e.initialize=function(){f(!0)};var f=function(a){a&&e.$on("$destroy",g)},g=function(){f(!1)};return e.save=function(a){log("30","LoginController","save",a,"valid",e.form),e.state="submitted",e.form.$invalid||(e.processing=!0,c.login(a,function(a){log("36","LoginController","login",a),e.processing=!1,e.form.$setPristine(),c.loggedin?d.redirectTo(["home"]):e.state="invalid"}))},e.initialize(),e}]),app.controller("HomeController",["$scope","$timeout","apiService","CmsConfig",function(a,b,c,d){var e=this;e=a,e.initialize=function(){log("8","HomeController","initialize",""),e.tables=d.tables,e.setTitle(""),f(),g(!0)};var f=function(){var a=[];for(var b in e.tables)a.push(b);c.get_row_count({tables:a},function(a){log("22","getRowCount","",a);for(var b in a.result)e.tables[b].count=a.result[b]})},g=function(a){a&&e.$on("$destroy",h)},h=function(){g(!1)};return e.initialize(),e}]);